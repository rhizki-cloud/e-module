<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ringkasan E-Modul</title>
    <link rel="icon" type="image/png" href="logo.jpg">
    
    <link rel="stylesheet" href="style.css" id="main-stylesheet">
    <script>document.getElementById('main-stylesheet').href = 'style.css?v=' + new Date().getTime();</script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    
    <div class="balloon-container">
        <div class="balloon"></div>
        <div class="balloon"></div>
        <div class="balloon"></div>
        <div class="balloon"></div>
        <div class="balloon"></div>
        <div class="balloon"></div>
        <div class="balloon"></div>
    </div>

    <div class="center-container"> 
        <div class="summary-container"> <h2 class="summary-header mb-4">
                Selamat, <span id="summary-username-title" style="color: #2a6f47;">...</span>!
                <span class="completion-emoji d-block mt-2">ðŸŽ‰</span>
            </h2>
            <p class="text-center text-muted lead">Anda telah menyelesaikan e-modul EMOform. Berikut adalah ringkasan dari jawaban dan refleksi Anda.</p>

            <div class="summary-item mt-4">
                <h5><i class="bi bi-person-fill me-2"></i> Nama Pengguna:</h5>
                <p class="summary-answer" id="summary-username"></p>
            </div>
            <div class="summary-item">
                <h5><i class="bi bi-lightbulb-fill me-2"></i> Motivasi Anda</h5>
                <p class="summary-answer" id="summary-motivasi"></p>
            </div>
            <div class="summary-item">
                <h5><i class="bi bi-journal-check me-2"></i> Hal terpenting yang Anda pelajari</h5>
                <p class="summary-answer" id="summary-refleksi1"></p>
            </div>
            <div class="summary-item">
                <h5><i class="bi bi-bullseye me-2"></i> Area yang ingin Anda latih</h5>
                <p class="summary-answer" id="summary-refleksi2"></p>
            </div>
            
            <div class="d-grid gap-2 col-md-6 mx-auto mt-5">
                <button class="btn btn-danger" onclick="clearDataAndExit()">
                    <i class="bi bi-arrow-repeat me-2"></i> Mulai Ulang / Keluar
                </button>
                <a href="module.html" class="btn btn-outline-secondary mt-2">Kembali ke Modul</a>
            </div>
            
            <div id="submit-status" class="text-center text-muted small mt-3" style="display: none;">
                <div class="spinner-border spinner-border-sm" role="status"></div>
                Menyimpan jawaban Anda...
            </div>

        </div>
    </div>

    <form id="hidden-form" action="https://formspree.io/f/manadjbo" method="POST" style="display:none;">
        <input type="text" name="Nama Pengguna" id="form-username">
        <textarea name="Motivasi" id="form-motivasi"></textarea>
        <textarea name="Refleksi 1 (Pelajaran)" id="form-refleksi1"></textarea>
        <textarea name="Refleksi 2 (Area Latihan)" id="form-refleksi2"></textarea>
    </form>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userName = localStorage.getItem('emoform_username') || "Tidak Ditemukan";
            const motivasi = localStorage.getItem('emoform_motivasi') || "Tidak diisi";
            const refleksi1 = localStorage.getItem('emoform_refleksi1') || "Tidak diisi";
            const refleksi2 = localStorage.getItem('emoform_refleksi2') || "Tidak diisi";

            // Cek bypass
            if (userName === "Tidak Ditemukan" || motivasi === "Tidak diisi") {
                Swal.fire({
                    icon: 'warning',
                    title: 'Sesi Tidak Ditemukan',
                    text: 'Anda harus menyelesaikan modul terlebih dahulu.',
                    confirmButtonColor: '#4a7c59',
                    allowOutsideClick: false
                }).then(() => {
                    window.location.href = 'index.html';
                });
                return;
            }

            // 1. Tampilkan data di halaman
            document.getElementById('summary-username-title').innerText = userName;
            document.getElementById('summary-username').innerText = userName;
            document.getElementById('summary-motivasi').innerText = motivasi;
            document.getElementById('summary-refleksi1').innerText = refleksi1;
            document.getElementById('summary-refleksi2').innerText = refleksi2;

            // 2. Kirim data ke Formspree
            submitAnswers(userName, motivasi, refleksi1, refleksi2);
        });

        // FUNGSI UNTUK MENGIRIM DATA
        async function submitAnswers(userName, motivasi, refleksi1, refleksi2) {
            const form = document.getElementById('hidden-form');
            const status = document.getElementById('submit-status');
            
            // Isi data ke form tersembunyi
            document.getElementById('form-username').value = userName;
            document.getElementById('form-motivasi').value = motivasi;
            document.getElementById('form-refleksi1').value = refleksi1;
            document.getElementById('form-refleksi2').value = refleksi2;

            // Tampilkan status "Menyimpan..."
            status.style.display = 'block';

            try {
                // Kirim data menggunakan Fetch API
                const response = await fetch(form.action, {
                    method: form.method,
                    body: new FormData(form),
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    status.innerText = "Jawaban berhasil disimpan.";
                } else {
                    status.innerText = "Gagal menyimpan jawaban.";
                }
            } catch (error) {
                console.error('Error submitting form:', error);
                status.innerText = "Error: Tidak dapat terhubung.";
            }
        }

        // Fungsi SweetAlert Anda
        function clearDataAndExit() {
            Swal.fire({
                title: 'Apakah Anda yakin?',
                text: "Semua data jawaban Anda akan dihapus!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#4a7c59',
                confirmButtonText: 'Ya, mulai ulang!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.clear(); 
                    window.location.href = 'index.html';
                }
            });
        }
    </script>
</body>
</html>